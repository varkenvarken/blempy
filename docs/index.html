<!DOCTYPE html>
<html>
 <head>
  <title>
   README.md
  </title>
  <meta content="text/html;charset=utf-8" http-equiv="Content-type"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <!-- Amaranth font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Amaranth:700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background: #f7fafc;
        margin: 0;
        padding: 0;
        color: #1a1a1a;
        width: 900px;
        margin:auto;
    }

    header {
        background: #fff;
        color: #2a4d69;
        padding: 2rem 1rem 1rem 1rem;
        text-align: center;
    }

    header a {
        color: #2a4d69;
        text-decoration: none;
        font-weight: bold;
    }

    header a:visited {
        color: #2a4d69;
        text-decoration: none;
    }

    #logo {
        max-width: 300px;
        margin-bottom: 1rem;
        float: left;
        margin-top: -20px;
    }

    h1,
    h2 {
        font-family: 'Amaranth', Arial, sans-serif;
    }

    h1 {
        margin-top: 0;
        font-size: 2.4rem;
    }

    h2 {
        color: #2a4d69;
    }

    .container {
        max-width: 900px;
        margin: 2rem auto 0 auto;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        padding: 2rem;
    }

    ul {
        margin: 1rem 0 1rem 2rem;
    }

    pre,
    code {
        background: #f3f3f3;
        border-radius: 4px;
        padding: 0.2em 0.4em;
        font-size: 1em;
    }

    pre {
        padding: 1em;
        overflow-x: auto;
    }

    footer {
        text-align: center;
        padding: 2rem 1rem 1rem 1rem;
        color: #888;
        font-size: 1rem;
    }

    @media (max-width: 600px) {
        .container {
            padding: 1rem;
        }

        h1 {
            font-size: 1.5rem;
        }
    }

    .github-link {
        color: #4183c4;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.2s;
    }

    .github-link:hover {
        color: #23527c;
    }

    .badge-list {
        margin-bottom: 1.5rem;
    }

    .badge-list img {
        vertical-align: middle;
        height: 24px;
        margin-right: 6px;
    }
  </style>
  <style>
   /*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
  </style>
  <script src="https://unpkg.com/mermaid/dist/mermaid.min.js">
  </script>
 </head>
 <body>
  <script>
   mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
  <img src="./blempy-logo.svg" width="250px"/>
  <p>
   <img alt="GitHub Release" src="https://img.shields.io/github/v/release/varkenvarken/blempy?include_prereleases&amp;logo=github"/>
   <img alt="PyPI - Version" src="https://img.shields.io/pypi/v/blempy"/>
  </p>
  <h1 id="blempy--blender-%E2%86%94-numpy-helpers">
   blempy — Blender ↔ NumPy helpers
  </h1>
  <p>
   <code>
    blempy
   </code>
   provides small, safe utilities to efficiently transfer Blender property-collection attributes (e.g. vertex coordinates) to/from NumPy arrays and perform vectorized operations with minimal Python overhead.
  </p>
  <blockquote>
   <p>
    [!NOTE]
    <br/>
    This module is not fully fleshed out yet, and its contents/interface may change
   </p>
  </blockquote>
  <h2 id="key-classes">
   Key classes
  </h2>
  <p>
   This module contains several utility classes which allow for efficient manipulation of property collections.
  </p>
  <p>
   The class
   <code>
    PropertyCollection
   </code>
   takes care of allocating suitably sized and shaped numpy ndarrays
when getting attributes from a property collection and can also copy those values back.
  </p>
  <p>
   The class
   <code>
    UnifiedAttribute
   </code>
   is designed to deal with unified attribute layers, including those in the CORNER domain.
These so called loop layers are associated with, but separated from, faces and indexed using loop indices stored
with a face. These loop indices are property collections too, but this is all dealt with transparently.
  </p>
  <p>
   Both classes behave like lists: they can be iterated over and allow index based access. The key difference between
the two classes is that the
   <code>
    UnifiedAttribute
   </code>
   class will iterate over polygons (faces) if it dealing with an attribute in the CORNER domain and return a reference to an array of attributes, otherwise it will behave like a regular
   <code>
    PropertyCollection
   </code>
   and return a reference to a single attribute.
  </p>
  <p>
   The references that will be returned are always numpy arrays, for the uv coordinates of a single face with 4 vertices, an
   <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html">
    ndarray
   </a>
   with shape (4,2) will be returned, whereas for the
   <code>
    hide
   </code>
   attribute of a face, an ndarray with shape (1,) will be returned. All those references are
   <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.view.html">
    views
   </a>
   , not copies, so can be assigned to.
  </p>
  <p>
   Both classes also provide utility functions to work with properties that are vectors, for example they
have methods to convert between 3D and 4D vectors as well as a
   <strong>
    matmul
   </strong>
   method for matrix multiplication with
the
   <code>
    @
   </code>
   operator, which will apply the matrix multiplication to the whole collection of vector properties at once.
  </p>
  <h2 id="minimal-usage-examples">
   Minimal usage examples
  </h2>
  <p>
   Transforming all vertex coordinates:
  </p>
  <pre class="hljs"><code><div><span class="hljs-keyword">from</span> mathutils <span class="hljs-keyword">import</span> Matrix
<span class="hljs-keyword">from</span> bpy.context <span class="hljs-keyword">import</span> active_object
<span class="hljs-keyword">from</span> blempy <span class="hljs-keyword">import</span> PropertyCollection

mesh = active_object.data
vproxy = PropertyCollection(mesh, <span class="hljs-string">"vertices"</span>, <span class="hljs-string">"co"</span>)
vproxy.get()                                      <span class="hljs-comment"># load vertex coordinates into vproxy.ndarray</span>
vproxy.extend()                                   <span class="hljs-comment"># convert to 4D so that matrix multiplication</span>
                                                  <span class="hljs-comment"># can deal with translation too</span>
matrix = Matrix.Rotation(pi/<span class="hljs-number">4</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])        <span class="hljs-comment"># combine a rotation and</span>
matrix = matrix @ Matrix.Translation(<span class="hljs-number">4</span>, [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])  <span class="hljs-comment"># a translation into a single matrix  </span>
vproxy = vproxy @ matrix                          <span class="hljs-comment"># transform in-place</span>
vproxy.discard()                                  <span class="hljs-comment"># discard the 4th column</span>
vproxy.set()                                      <span class="hljs-comment"># write back to mesh</span>
</div></code></pre>
  <p>
   Give all faces of a mesh a uniform but unique random greyscale color:
  </p>
  <pre class="hljs"><code><div><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> bpy.context <span class="hljs-keyword">import</span> active_object
<span class="hljs-keyword">from</span> blempy <span class="hljs-keyword">import</span> UnifiedAttribute

mesh = active_object.data
<span class="hljs-comment"># assume the mesh already has a vertex color layer called "Color"</span>
proxy = blempy.UnifiedAttribute(mesh, <span class="hljs-string">"Color"</span>)

<span class="hljs-comment"># iterate over faces and set all loops in each individual face to a distinct grey level</span>
<span class="hljs-comment"># setting all loops to the same value will cause the face to have a uniform color</span>
<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> no need for a proxy.get() call, we will replace all data so we don´t need the originals</span>
<span class="hljs-keyword">for</span> index, polygon_loops <span class="hljs-keyword">in</span> enumerate(proxy):
    grey_level = random()
    polygon_loops[:] = [grey_level, grey_level, grey_level, <span class="hljs-number">1.0</span>]

<span class="hljs-comment"># sync data back to the mesh</span>
proxy.set()
</div></code></pre>
  <h2 id="installation">
   Installation
  </h2>
  <p>
   <code>
    blempy
   </code>
   is available as a package on
   <a href="https://pypi.org/project/blempy/">
    pypi
   </a>
   and can be installed in the usual way:
  </p>
  <pre class="hljs"><code><div>python -m pip install blempy
</div></code></pre>
  <p>
   But that would install the package in the default location. That is fine if you use Blender as a module,
but if your are developing an add-on that you want to bundle and distribute to others, it is probably best
to install it right into the folder of the add-on you are developing:
  </p>
  <pre class="hljs"><code><div><span class="hljs-built_in">cd</span> your-add-on
python -m pip install -t . blempy
</div></code></pre>
  <p>
   If for some reason you want to install
   <code>
    blempy
   </code>
   inside your Blender environment,
then things are a bit more complicated because you will need to find out
where the python that is bundled with Blender is and then install it there.
A refresher on how to do that can be found in
   <a href="https://blog.michelanders.nl/2021/06/installing-python-packages-with-pip-in-your-blender-environment.html">
    this old article
   </a>
   ,
but think twice before you decide to do that because you will have to repeat this every
time you install a new version of Blender.
  </p>
  <h2 id="todo">
   TODO
  </h2>
  <ul>
   <li>
    <p>
     <input id="checkbox0" type="checkbox"/>
     <label for="checkbox0">
      additional convenience functions for frequently used vector operations like translate, scale, rotate, space conversions, ...
     </label>
    </p>
   </li>
   <li>
    <p>
     <input id="checkbox1" type="checkbox"/>
     <label for="checkbox1">
      ... possibly even mapped to dunder methods (like
     </label>
     <code>
      __add__
     </code>
     for translation or
     <code>
      __mul__
     </code>
     for scale, etc.)
    </p>
   </li>
   <li>
    <p>
     <input id="checkbox2" type="checkbox"/>
     <label for="checkbox2">
      extend AttributeProxy to work with objects types other than Mesh and PointCloud
     </label>
    </p>
    <p>
     curve etc.
    </p>
   </li>
  </ul>
 </body>
</html>
